version: 2
models:
  - name: defi__fact_tcy_stake_events
    description: "Comprehensive fact table tracking THORchain Yield (TCY) staking events and transactions. This table captures detailed information about user staking activities including transaction IDs, staked amounts, RUNE addresses, memo fields, and precise timing information. Essential for analyzing user staking behavior patterns, calculating total value locked (TVL) in TCY pools, measuring staking trends over time, and understanding liquidity provision dynamics. Each record represents a unique TCY staking transaction with complete user and transaction metadata for thorough yield farming analysis, user behavior tracking, and protocol performance monitoring."
    columns:
      - name: FACT_TCY_STAKE_EVENTS_ID
        description: "{{ doc('sk') }}"
        tests:
          - dbt_expectations.expect_column_to_exist
          - unique
      - name: BLOCK_TIMESTAMP
        description: "{{ doc('block_timestamp') }}"
        tests:
          - not_null:
              where: DIM_BLOCK_ID not in ('-1','-2')
      - name: DIM_BLOCK_ID
        description: "FK to DIM_BLOCK table"
        tests:
          - negative_one:
              where: _inserted_timestamp <  (CURRENT_TIMESTAMP - INTERVAL '8 HOURS')
      - name: TX_ID
        description: "{{ doc('tx_id') }}"
        tests:
          - not_null
      - name: RUNE_ADDRESS
        description: "{{ doc('address') }}"
        tests:
          - not_null
      - name: AMOUNT
        description: "The amount"
        tests:
          - not_null
      - name: MEMO
        description: "{{ doc('memo') }}"
      - name: EVENT_ID
        description: "{{ doc('id') }}"
        tests:
          - not_null
      - name: INSERTED_TIMESTAMP
        description: '{{ doc("inserted_timestamp") }}'   
      - name: MODIFIED_TIMESTAMP
        description: '{{ doc("modified_timestamp") }}'  
    tests:
      - dbt_constraints.primary_key:
          column_name: FACT_TCY_STAKE_EVENTS_ID
      - dbt_constraints.foreign_key:
          fk_column_name: DIM_BLOCK_ID
          pk_table_name: ref('core__dim_block')
          pk_column_name: DIM_BLOCK_ID
